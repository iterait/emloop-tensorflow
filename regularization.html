<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Model regularization &#8212; cxflow-tensorflow 0.3.0 documentation</title>
    
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/highlight.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Multi-GPU models" href="multi_gpu.html" />
    <link rel="prev" title="Tutorial" href="tutorial.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          cxflow-tensorflow</a>
        <span class="navbar-text navbar-version pull-left"><b>0.3</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="getting_started.html">Getting Started</a></li>
                <li><a href="tutorial.html">Tutorial</a></li>
                <li><a href="#">Model Regularization</a></li>
                <li><a href="multi_gpu.html">Multi GPU models</a></li>
                <li><a href="cxflow_tensorflow/index.html">API Reference</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Pages <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
          </ul>
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">
<div class="side_nav">
    <a href="tutorial.html" title="Previous Chapter: Tutorial"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Tutorial</span>
    </a>
    </div>
<div class="side_nav">
    <a href="multi_gpu.html" title="Next Chapter: Multi-GPU models"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Multi-GPU models &raquo;</span>
    </a>
    </div><ul>
<li><a class="reference internal" href="#">Model regularization</a><ul>
<li><a class="reference internal" href="#dropout">Dropout</a></li>
<li><a class="reference internal" href="#weight-decay">Weight decay</a></li>
<li><a class="reference internal" href="#batch-normalization">Batch normalization</a></li>
</ul>
</li>
</ul>

<form action="search.html" method="get" class="searchbox">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form><div class="side_nav">
	<h4>Related projects</h4>
</div>
<ul class="nav nav-list">
	<li><a href="https://cxflow.org">cxflow</a></li>
	<li><a href="https://tensorflow.cxflow.org">cxflow-tensorflow</a></li>
	<li><a href="https://cxtream.org">cxtream</a> (C++)</li>
</ul>
        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="model-regularization">
<h1>Model regularization<a class="headerlink" href="#model-regularization" title="Permalink to this headline">¶</a></h1>
<p>Model over-fitting is the most common cause of sub-optimal model performance.
For this reason, various model regularization techniques have emerged in the past years.
All of them, naturally, can be used in <strong>cxflow-tensorflow</strong>.</p>
<p>In this brief tutorial we show how to incorporate the most common ones to <strong>cxflow-tensorflow</strong> models.</p>
<div class="section" id="dropout">
<h2>Dropout<a class="headerlink" href="#dropout" title="Permalink to this headline">¶</a></h2>
<p>Dropout is well known technique preventing over-fitting introduced by
<a class="reference external" href="https://www.cs.toronto.edu/~hinton/absps/JMLRdropout.pdf">Srivastava et al.</a> in 2014.
Simply said, dropout layer randomly selects certain portion of units and sets them to zero.
In fact, this is done only in the training phase.
For this reason, we need to distinguish training and evaluation phases.
In <strong>cxflow-tensorflow</strong>, this information is fed to the model via special scalar tensor defined in
<a class="reference internal" href="cxflow_tensorflow/cxflow_tensorflow.html#cxflow_tensorflow.BaseModel" title="cxflow_tensorflow.BaseModel"><code class="xref py py-class docutils literal"><span class="pre">cxflow_tensorflow.BaseModel</span></code></a> and accessible through <code class="docutils literal"><span class="pre">self.is_training</span></code> property.</p>
<p>E.g. we can add dropout layer during the model creation as follows:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">tensorflow layers</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_create_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_training</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>or if we prefer Keras:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Keras</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_create_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">512</span><span class="p">)(</span><span class="nb">input</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)(</span><span class="n">output</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_training</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="weight-decay">
<h2>Weight decay<a class="headerlink" href="#weight-decay" title="Permalink to this headline">¶</a></h2>
<p>Weight decay, also known as L2 regularization is yet another common way to regularize deep learning models.
To apply weight decay in <strong>cxflow-tensorflow</strong>, add the regularization cost the <code class="docutils literal"><span class="pre">REGULARIZATION_LOSSES</span></code>
TensorFlow graph collection.</p>
<p>E.g.:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">adding explicit regularization loss</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_create_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">add_to_collection</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">GraphKeys</span><span class="o">.</span><span class="n">REGULARIZATION_LOSSES</span><span class="p">,</span> <span class="n">my_loss</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Luckily, most of the common layer APIs will do that for you.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Keras adds the regularization cost implicitly</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_create_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">kernel_regularizer</span><span class="o">=</span><span class="n">K</span><span class="o">.</span><span class="n">regularizers</span><span class="o">.</span><span class="n">l2</span><span class="p">(</span><span class="mf">0.0001</span><span class="p">))(</span><span class="n">net</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">To see the list of utilized regularization loss names, run <strong>cxflow</strong> with <code class="docutils literal"><span class="pre">--verbose</span></code> argument.</p>
</div>
</div>
<div class="section" id="batch-normalization">
<h2>Batch normalization<a class="headerlink" href="#batch-normalization" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://arxiv.org/abs/1502.03167">Batch normalization</a> appears to be quite popular method improving generalization
abilities of deep learning models.
Batch normalization layers maintain reasonable activations even in very deep networks by scaling the activations with
learned batch statistics.
Those statistics (means and variances) have to be updated during the training phase.
The update TensorFlow ops are expected in the <code class="docutils literal"><span class="pre">UPDATE_OPS</span></code> TensorFlow graph collection.</p>
<p>Again, both Keras and TensorFlow layers API do this for you so that adding batch normalization to your models is
simple and lucid.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">adding batch normalization</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_create_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">batch_normalization</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_training</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017, Cognexa Solutions s.r.o..<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>